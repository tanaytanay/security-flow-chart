<!DOCTYPE html>
<meta charset="utf-8">
<body>
<svg width="800" height="600"></svg>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const svg = d3.select("svg");
const width = +svg.attr("width");
const height = +svg.attr("height");

// --- Define hubs ---
const hubs = [
  { id: "hub1", x: width/2, y: height/4, icon: "🛡️", label: "Hub 1" },
  { id: "hub2", x: width/4, y: (3*height)/4, icon: "⚡", label: "Hub 2" },
  { id: "hub3", x: (3*width)/4, y: (3*height)/4, icon: "🔥", label: "Hub 3" }
];

// --- Define children ---
const children = [
  { id: "c1", icon: "📁", label: "C1" },
  { id: "c2", icon: "📁", label: "C2" },
  { id: "c3", icon: "📁", label: "C3" },
  { id: "c4", icon: "📁", label: "C4" },
  { id: "c5", icon: "📁", label: "C5" },
  { id: "c6", icon: "📁", label: "C6" }
];

// --- Define links ---
const links = [
  { source: "hub1", target: "c1" },
  { source: "hub1", target: "c2" },
  { source: "hub2", target: "c2" },
  { source: "hub2", target: "c3" },
  { source: "hub3", target: "c3" },
  { source: "hub3", target: "c4" },
  { source: "hub1", target: "c5" },
  { source: "hub3", target: "c5" },
  { source: "hub2", target: "c6" }
];

// --- Position children around hubs ---
const radius = 80;
hubs.forEach(hub => {
  const hubChildren = links
    .filter(l => l.source === hub.id)
    .map(l => children.find(c => c.id === l.target));

  hubChildren.forEach((child, i) => {
    if (child.x === undefined && child.y === undefined) {
      child.x = hub.x + radius * Math.cos((2 * Math.PI * i) / hubChildren.length);
      child.y = hub.y + radius * Math.sin((2 * Math.PI * i) / hubChildren.length);
    } else {
      child.x = (child.x + hub.x) / 2;
      child.y = (child.y + hub.y) / 2;
    }
  });
});

// --- Combine all nodes ---
const nodes = [...hubs, ...children];

// --- Draw links ---
const link = svg.selectAll("line")
  .data(links)
  .join("line")
  .attr("stroke", "#333")
  .attr("stroke-width", 2);

// --- Draw nodes using <g> ---
const node = svg.selectAll("g")
  .data(nodes)
  .join("g")
  .attr("transform", d => `translate(${d.x},${d.y})`)
  .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended)
  )
  .on("click", (event, d) => {
    if (!hubs.includes(d)) childClicked(d);
  });

// --- Add circles ---
node.append("circle")
  .attr("r", d => hubs.includes(d) ? 30 : 20)
  .attr("fill", d => hubs.includes(d) ? "#f66" : "#6cf")
  .attr("stroke", "#000")
  .attr("stroke-width", 1.5);

// --- Add icon inside circle ---
node.append("text")
  .attr("text-anchor", "middle")
  .attr("dy", "-2") // slightly above center for label space
  .attr("font-size", d => hubs.includes(d) ? 18 : 14)
  .text(d => d.icon);

// --- Add label inside circle, below icon ---
node.append("text")
  .attr("text-anchor", "middle")
  .attr("dy", "14") // below the icon
  .attr("font-size", d => hubs.includes(d) ? 12 : 10)
  .text(d => d.label);

// --- Update positions ---
function update() {
  link
    .attr("x1", d => nodes.find(n => n.id === d.source).x)
    .attr("y1", d => nodes.find(n => n.id === d.source).y)
    .attr("x2", d => nodes.find(n => n.id === d.target).x)
    .attr("y2", d => nodes.find(n => n.id === d.target).y);

  node.attr("transform", d => `translate(${d.x},${d.y})`);
}

// --- Drag handlers ---
function dragstarted(event, d) { d3.select(this).raise(); }
function dragged(event, d) { d.x = event.x; d.y = event.y; update(); }
function dragended(event, d) {}

// --- Child click handler ---
function childClicked(child) { console.log("Child clicked:", child.id); }

// --- Initial render ---
update();
</script>
</body>
